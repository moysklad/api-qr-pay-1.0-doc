## Аутентификация запросов

Каждый запрос к API подписывается одноразовым токеном, сформированным с использованием RSA-ключа.

+ Токен - это JWT, содержащий:
  + Заголовок `kid` - уникальный идентификатор ключа, использованного для подписи токена
  + `id` - уникальный идентификатор токена
  + `exp` - срок действия токена в формате `UNIX timestamp`
  + `iat` - время формирования токена в формате `UNIX timestamp`
  + `iss` - идентификатор сервиса выпустившего токен. Должно содержать значение `https://moysklad.ru`
+ Подпись выполняется приватным ключом отправителя по алгоритму `RS256`.
+ Публичный ключ для проверки подписи необходимо получать из JWKS по следующему
  URL: [https://pay-qr.moysklad.ru/.well-known/jwks.json](https://pay-qr.moysklad.ru/.well-known/jwks.json)
+ При обработке запроса сервер должен:
  + Получить актуальный набор ключей из JWKS.
  + Найти в ответе ключ соответствующий полю `kid` в заголовке токена.
  + Проверить корректность подписи токена.
  + Убедиться, что `id` токена ранее не использовался.
  + Проверить, что `exp` не истёк на момент валидации.

**Важно:** Токен одноразовый и становится недействительным сразу после успешной проверки.
